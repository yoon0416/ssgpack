<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
  <meta charset="UTF-8">
  <title>ì„ ìˆ˜ ìƒì„¸ì •ë³´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: sans-serif;
      background-color: #f9f9f9;
      padding: 20px;
    }
    .record-table {
      width: 100%;
      border-collapse: collapse;
    }
    .record-table th, .record-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    .record-table th {
      background-color: #eee;
    }
    .info-table {
	  width: 100%;
	  border-collapse: collapse;
	  font-size: 17px;             /* ì£¼ìš”ê¸°ë¡ë³´ë‹¤ ê¸€ì”¨ ì•½ê°„ í¼ */
	  margin-top: 10px;
	  table-layout: fixed;
	}
	
	.info-table th, .info-table td {
	  border: 1px solid #ccc;
	  padding: 16px 20px;       /* âœ… ë„‰ë„‰í•œ ì—¬ë°±! */
	  text-align: center;         /* âœ… ê¸€ìëŠ” ì™¼ìª½ ì •ë ¬ */
	  word-break: keep-all;
	}
	
	.info-table th {
	  background-color: #f7f7f7;
	  font-weight: bold;
	  width: 18%;
	}
  </style>
</head>
<body>
<th:block layout:fragment="content">

  <div class="container my-5 p-4 bg-white shadow-sm rounded">

    <!-- âœ… ì´ë¯¸ì§€ + í…ìŠ¤íŠ¸ ë‚˜ë€íˆ -->
    <div style="display: flex; align-items: center; gap: 25px;">
      <img id="playerImage" src="" alt="ì„ ìˆ˜ ì´ë¯¸ì§€"
           style="width: 160px; height: 210px; object-fit: contain; 
           background-color: white; align-self: flex-end;" />
      <div>
        <h1 id="playerName" style="margin: 0 0 10px 0; font-size: 24px;">ì„ ìˆ˜ ì´ë¦„</h1>
        <h3 id="playerPosition" style="margin: 0 0 10px 0; font-size: 16px; color:red">í¬ì§€ì…˜</h3>
        <p id="playerInfo" style="margin: 0; font-size: 16px; color: #555;">ì„ ìˆ˜ ê¸°ë³¸ ì •ë³´ í‘œì‹œ ì˜ˆì •</p>
      </div>
    </div>

    <h2 class="mt-4">ğŸ§¾ì£¼ìš” ê¸°ë¡ğŸ§¾</h2>
    <table class="record-table table table-bordered mt-4" id="recordTable">
      <thead class="table-light">
        <tr>
          <th>ì—°ë„</th>
          <th>WAR</th>
          <th>íƒ€ìœ¨</th>
          <th>í™ˆëŸ°</th>
          <th>íƒ€ì </th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const pathParts = window.location.pathname.split("/");
      const pNo = pathParts[pathParts.length - 1];

      fetch(`/api/players/${pNo}`)
        .then(res => res.json())
        .then(player => {
          console.log("âœ… ì‘ë‹µ ë°ì´í„°:", player);
          console.log("âœ… ì´ë¯¸ì§€ ê²½ë¡œ:", player.imageUrl);

          document.getElementById('playerName').textContent = player.name;
          document.getElementById('playerPosition').textContent = player.position;
          document.getElementById('playerInfo').innerHTML = `
        	  <table class="info-table" style="margin-top: 10px;">
        	    <tr><th>ë“±ë²ˆí˜¸</th><td>${player.backNumber ?? 'ì •ë³´ ì—†ìŒ'}</td>
        	    <th>ìƒë…„ì›”ì¼</th><td>${player.birthDate ?? 'ì •ë³´ ì—†ìŒ'}</td></tr>
        	    <tr><th>ì‹ ì¸ì§€ëª…</th><td>${player.draftInfo ?? 'ì •ë³´ ì—†ìŒ'}</td>
        	    <th>í™œì•½ì—°ë„</th><td>${player.activeYears ?? 'ì •ë³´ ì—†ìŒ'}</td></tr>
        	    <tr><th>í™œì•½íŒ€</th><td>${player.teams ?? 'ì •ë³´ ì—†ìŒ'}</td>
        	    <th>í•™êµ</th><td>${player.school ?? 'ì •ë³´ ì—†ìŒ'}</td></tr>
        	  </table>
        	`;

          const imgEl = document.getElementById('playerImage');
          if (imgEl && player.imageUrl) {
            imgEl.src = player.imageUrl;
            imgEl.onerror = () => { imgEl.src = '/images/players/default.png'; };
          }

          const tbody = document.querySelector('#recordTable tbody');
          (player.stats ?? []).forEach(stat => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${stat.season}</td>
              <td>${stat.war}</td>
              <td>${stat.avg ?? '-'}</td>
              <td>${stat.obp ?? '-'}</td>
              <td>${stat.slg ?? '-'}</td>
            `;
            tbody.appendChild(tr);
          });
        })
        .catch(err => {
          console.error('âŒ ì„ ìˆ˜ ì •ë³´ ë¡œë”© ì‹¤íŒ¨:', err);
          document.getElementById('playerName').textContent = 'âŒ ì„ ìˆ˜ ì •ë³´ ì—†ìŒ';
        });
    });
  </script>

</th:block>
</body>
</html>
