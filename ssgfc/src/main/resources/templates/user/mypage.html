<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{fragments/layout}">
<head>
<title>ë§ˆì´í˜ì´ì§€</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Honk&display=swap" rel="stylesheet">

<!-- Bootstrap Icons CDN -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
.mypage-container {
	padding: 40px;
	border-radius: 16px;
	background-color: #fff;
	box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
}

.profile-img {
	width: 110px;
	height: 110px;
	border-radius: 50%;
	object-fit: cover;
	border: 2px solid #dee2e6;
	margin-bottom: 15px;
}

.mypage-container h2 {
	font-weight: 800;
	margin-bottom: 30px;
}

.mypage-container p {
	font-size: 16px;
	margin-bottom: 10px;
}

.mypage-container p strong {
	display: inline-block;
	width: 100px;
	color: #444;
}

.button-group {
	display: flex;
	flex-wrap: wrap;
	justify-content: center;
	gap: 12px;
	margin-top: 24px;
}

.button-group .btn {
	min-width: 130px;
	padding: 10px 16px;
	font-size: 15px;
	border-radius: 8px;
}

.slide-box {
	max-height: 0;
	overflow: hidden;
	transition: max-height 0.4s ease;
}

.slide-box.active {
	max-height: 100px;
}

.withdraw-box {
	margin-top: 32px;
}

.btn-outline-success {
	padding: 2px 10px;
	font-size: 13px;
	margin-left: 8px;
}

.btn-danger {
	background-color: #dc3545;
	border: none;
}

.btn-danger:hover {
	background-color: #bb2d3b;
}

.animate-pop {
	transition: transform 0.2s ease;
}

.animate-pop:hover {
	transform: scale(1.08);
}

@media ( max-width : 576px) {
	.button-group .btn {
		min-width: 100%;
	}
}

/* âœ… ë±ƒì§€ ìŠ¤íƒ€ì¼ */
.badge-container {
	display: flex;
	flex-wrap: wrap;
	gap: 10px;
	margin-bottom: 25px;
	justify-content: center;
}

.pretty-badge {
	display: inline-flex;
	align-items: center;
	background-color: #e3f2fd;
	color: #0d6efd;
	padding: 6px 12px;
	font-size: 14px;
	border-radius: 999px;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
	transition: transform 0.2s ease;
}

.pretty-badge:hover {
	transform: scale(1.08);
}

.pretty-badge i {
	margin-right: 6px;
	font-size: 16px;
}
</style>
</head>
<body>
	<th:block layout:fragment="content">
		<div class="container mt-5" style="max-width: 720px;">
			<div class="mypage-container text-center">

				<!--  ë±ƒì§€ UI (ì•„ì´ì½˜ ì˜¤ë¥˜ ì—†ëŠ” ë²„ì „) -->
				<div class="badge-container">
					<!--  badge ì•„ì´ì½˜ ì•„ì´ë””ë³„ë¡œ if ì²˜ë¦¬ -->
					<span th:each="badge : ${badges}" class="pretty-badge"> <i
						class="bi bi-chat-dots-fill" th:if="${badge} == 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸'"></i> <i
						class="bi bi-google" th:if="${badge} == 'êµ¬ê¸€ ë¡œê·¸ì¸'"></i> <i
						class="bi bi-envelope-paper" th:if="${badge} == 'ë„¤ì´ë²„ ë¡œê·¸ì¸'"></i> <i
						class="bi bi-envelope-check-fill" th:if="${badge} == 'ì´ë©”ì¼ ì¸ì¦'"></i>
						<i class="bi bi-phone-fill" th:if="${badge} == 'ì „í™”ë²ˆí˜¸ ì¸ì¦'"></i> <i
						class="bi bi-award"
						th:if="${badge} != 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸'
                                  and ${badge} != 'êµ¬ê¸€ ë¡œê·¸ì¸'
                                  and ${badge} != 'ë„¤ì´ë²„ ë¡œê·¸ì¸'
                                  and ${badge} != 'ì´ë©”ì¼ ì¸ì¦'
                                  and ${badge} != 'ì „í™”ë²ˆí˜¸ ì¸ì¦'"></i>
						<span th:text="${badge}"></span>
					</span>

				</div>

				<!-- í”„ë¡œí•„ ì‚¬ì§„ -->
<img th:if="${user.profile_img != null}"
     th:src="@{/images/userimage/{file}(file=${user.profile_img})}"
     class="profile-img" alt="í”„ì‚¬" />

<img th:if="${user.profile_img == null}"
     th:src="@{/images/userimage/default-profile.png}"
     class="profile-img" alt="í”„ì‚¬" />



				<h2>ë§ˆì´í˜ì´ì§€</h2>
<div th:unless="${user.verified}" class="alert alert-warning text-start mt-3" style="font-size: 15px;">
    <strong>âš  ì•„ì§ ì¸ì¦ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</strong><br>
    ì•„ë˜ ì¤‘ í•˜ë‚˜ ì´ìƒì„ ì™„ë£Œí•˜ë©´ ê¸€ì“°ê¸° ë° ëŒ“ê¸€ ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
    <ul class="mt-2 mb-0">
        <li>ì´ë©”ì¼ ì¸ì¦</li>
        <li>ì¹´ì¹´ì˜¤ / ë„¤ì´ë²„ / êµ¬ê¸€ ê°„í¸ ë¡œê·¸ì¸</li>
        <li>ì „í™”ë²ˆí˜¸ ì¸ì¦</li>
    </ul>
</div>

				<div class="text-start px-3">
					<!-- ì´ë©”ì¼ + ì¸ì¦ ìƒíƒœ -->
					<p>
						<strong>ì´ë©”ì¼:</strong> <span th:text="${user.email}"></span> <span
							th:if="${user.email_chk}" class="badge bg-success">ì¸ì¦ ì™„ë£Œ</span>
						<button type="button" class="btn btn-outline-success"
							onclick="openEmailPopup()">ì´ë©”ì¼ ì¸ì¦</button>
					</p>

					<p>
						<strong>ë‹‰ë„¤ì„:</strong> <span th:text="${user.nick_name}"></span>
					</p>
					<p>
						<strong>ê¶Œí•œ:</strong> <span th:text="${roleName}"></span>
					</p>

					<p th:if="${user.introduce != null and !user.introduce.isEmpty()}">
						<strong>ì†Œê°œ:</strong> <span th:text="${user.introduce}"></span>
					</p>

					<p th:if="${user.zipcode != null}">
						<strong>ìš°í¸ë²ˆí˜¸:</strong> <span th:text="${user.zipcode}"></span>
					</p>
					<p th:if="${user.address != null}">
						<strong>ê¸°ë³¸ ì£¼ì†Œ:</strong> <span th:text="${user.address}"></span>
					</p>
					<p th:if="${user.addressDetail != null}">
						<strong>ìƒì„¸ ì£¼ì†Œ:</strong> <span th:text="${user.addressDetail}"></span>
					</p>
					<p th:if="${user.phone != null}">
						<strong>ì „í™”ë²ˆí˜¸:</strong> <span th:text="${user.phone}"></span>
					</p>
				</div>

				<!-- ë²„íŠ¼ ì˜ì—­ -->
				<div class="button-group">
					<button class="btn btn-primary" onclick="toggleBox('editBox')">ì •ë³´
						ìˆ˜ì •</button>
					<button class="btn btn-warning" onclick="toggleBox('pwBox')">ë¹„ë°€ë²ˆí˜¸
						ë³€ê²½</button>
					<a th:href="@{/user/logout}" class="btn btn-outline-danger">ë¡œê·¸ì•„ì›ƒ</a>
					<a th:href="@{/main}" class="btn btn-outline-secondary">ë©”ì¸ìœ¼ë¡œ</a> <a
						th:href="@{/admin/dashboard}" class="btn btn-outline-primary"
						sec:authorize="hasAnyAuthority('ROLE_MASTER', 'ROLE_USER_MANAGER', 'ROLE_PLAYER_MANAGER', 'ROLE_BOARD_MANAGER', 'ROLE_GAME_MANAGER')">
						ê´€ë¦¬ì í˜ì´ì§€ </a>
						 <a th:href="@{/mygame/player-memory}" class="btn btn-success">ğŸ§  ê¸°ì–µë ¥ ê²Œì„</a>
				</div>

				<!-- ìŠ¬ë¼ì´ë“œ ë²„íŠ¼ -->
				<div id="editBox" class="slide-box">
					<a th:href="@{/user/mypage/edit}"
						class="btn btn-outline-primary w-100 mt-2">â¡ï¸ í”„ë¡œí•„ ì •ë³´ ìˆ˜ì •</a>
				</div>

				<div id="pwBox" class="slide-box">
					<a th:href="@{/user/password/change}"
						class="btn btn-outline-warning w-100 mt-2">â¡ï¸ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
				</div>

				<!-- íƒˆí‡´ -->
				<div class="withdraw-box text-center">
					<form id="withdrawForm" th:action="@{/user/withdraw}" method="post">
						<button type="button" class="btn btn-danger px-4 animate-pop"
							onclick="confirmAndSubmit()">íšŒì› íƒˆí‡´</button>
					</form>
				</div>
			</div>
		</div>

		<script>
    function confirmAndSubmit() {
        if (confirm("ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
            document.getElementById("withdrawForm").submit();
        }
    }

    function openEmailPopup() {
        const width = 500;
        const height = 400;
        const left = (screen.width - width) / 2;
        const top = (screen.height - height) / 2;
        window.open('/user/email/verify', 'emailPopup', `width=${width},height=${height},top=${top},left=${left}`);
    }

    function toggleBox(id) {
        const box = document.getElementById(id);
        const allBoxes = document.querySelectorAll(".slide-box");
        allBoxes.forEach(b => {
            if (b !== box) b.classList.remove("active");
        });
        box.classList.toggle("active");
    }
</script>
	</th:block>
</body>
</html>
