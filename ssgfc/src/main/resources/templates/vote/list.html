<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <title>íˆ¬í‘œ ëª©ë¡</title>
</head>

<body>
    <section layout:fragment="content">
        <div class="container mt-4" style="max-width: 700px;">
            <h2 class="fw-bold border-bottom pb-2 mb-4">ğŸ—³ï¸ íˆ¬í‘œ ëª©ë¡</h2>

            <!-- âœ… íˆ¬í‘œ ìƒì„± ë²„íŠ¼ -->
            <div class="mb-3" sec:authorize="hasAnyAuthority('ROLE_MASTER', 'ROLE_BOARD_MANAGER')">
                <a class="btn btn-success" href="/vote/create">+ íˆ¬í‘œ ìƒì„±</a>
            </div>

            <!-- âœ… íˆ¬í‘œ ë¦¬ìŠ¤íŠ¸ -->
            <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center" th:each="vote : ${votes}">
                    <a th:href="@{|/vote/${vote.id}|}"
                       th:text="${vote.title}"
                       class="text-decoration-none text-dark fw-bold">íˆ¬í‘œ ì œëª©</a>

                    <!-- âœ… ë§ˆê°ì¼ í‘œì‹œ -->
                    <div class="text-muted small" th:if="${vote.endDate != null}"
                         th:text="'ë§ˆê°: ' + ${#temporals.format(vote.endDate, 'yyyy-MM-dd HH:mm')}"></div>

                    <!-- âœ… ë§ˆê°ì¼ ì¹´ìš´íŠ¸ë‹¤ìš´ í‘œì‹œ -->
                    <div class="text-muted small" id="remainingTime" th:if="${vote.endDate != null}"
                         th:data-enddate="${vote.endDate}"></div>
                         
                    <div class="d-flex align-items-center">
                        <span class="text-muted small me-2"
                              th:text="${#temporals.format(vote.createDate, 'yyyy.MM.dd')}">ë‚ ì§œ</span>

                        <!-- âœ… ìˆ˜ì • ë²„íŠ¼: ë§ˆê°ì¼ì´ ì§€ë‚˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ë³´ì´ë„ë¡ -->
                        <div class="d-flex" sec:authorize="hasAnyAuthority('ROLE_MASTER', 'ROLE_BOARD_MANAGER')">
                            <!-- âœ… ì‚­ì œ ë²„íŠ¼ì€ ë§ˆê°ì¼ ê´€ê³„ì—†ì´ í•­ìƒ ë³´ì´ë„ë¡ -->
                            <form th:action="@{|/vote/delete/${vote.id}|}" method="post" class="me-1">
                                <button type="submit" class="btn btn-sm btn-danger"
                                        onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
                            </form>

                            <!-- âœ… ìˆ˜ì • ë²„íŠ¼: ë§ˆê°ì¼ì´ ì§€ë‚˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ë³´ì´ë„ë¡ -->
                            <a th:href="@{|/vote/edit/${vote.id}|}" class="btn btn-sm btn-outline-primary"
                               th:if="${vote.endDate == null or vote.endDate.isAfter(T(java.time.LocalDateTime).now())}">
                                ìˆ˜ì •
                            </a>
                        </div>
                    </div>

                </li>
            </ul>
        </div>
    </section>
    
	<th:block layout:fragment="script">
	    <script>
	        // âœ… ë§ˆê°ì¼ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸
	        function updateRemainingTime() {
	            const endDateElements = document.querySelectorAll('[id="remainingTime"]');
	            endDateElements.forEach(element => {
	                const endDate = new Date(element.getAttribute('data-enddate'));
	                const now = new Date();
	                const remainingTime = endDate - now;
	
	                if (remainingTime <= 0) {
	                    element.textContent = "ë§ˆê°ë¨";
	                } else {
	                    const seconds = Math.floor(remainingTime / 1000);
	                    const minutes = Math.floor(seconds / 60);
	                    const hours = Math.floor(minutes / 60);
	                    const days = Math.floor(hours / 24);
	
	                    const displayTime = `${days}ì¼ ${hours % 24}ì‹œê°„ ${minutes % 60}ë¶„ ${seconds % 60}ì´ˆ ë‚¨ìŒ`;
	                    element.textContent = displayTime;
	                }
	            });
	        }
	
	        setInterval(updateRemainingTime, 1000); // âœ… ë§¤ ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
	    </script>
	</th:block>
	
</body>
</html>
