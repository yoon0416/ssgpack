<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
  <meta charset="UTF-8">
  <title>ì„ ìˆ˜ ìƒì„¸ì •ë³´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background-color: #ffffff;
      padding: 20px;
    }
    .record-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 15px;
    }
    .record-table th, .record-table td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      vertical-align: middle;
    }
    .record-table th {
      background-color: #f2f2f2;
    }
    .info-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 17px;
      margin-top: 10px;
      table-layout: fixed;
    }
    .info-table th, .info-table td {
      border: 1px solid #ccc;
      padding: 16px 20px;
      text-align: center;
      word-break: keep-all;
    }
    .info-table th {
      background-color: #f7f7f7;
      font-weight: bold;
      width: 18%;
    }
  </style>
</head>
<body>
<th:block layout:fragment="content">

  <div class="container my-5 p-4 bg-white shadow-sm rounded">
    <p id="viewCount" style="font-size: 14px; color: gray;">ì¡°íšŒìˆ˜: 0</p>
    <div style="display: flex; align-items: center; gap: 25px;">
      <img id="playerImage" src="" alt="ì„ ìˆ˜ ì´ë¯¸ì§€"
           style="width: 160px; height: 210px; object-fit: contain; background-color: white; align-self: flex-end;" />
      <div>
        <h1 id="playerName" style="margin: 0 0 10px 0; font-size: 24px;">ì„ ìˆ˜ ì´ë¦„</h1>
        <h3 id="playerPosition" style="margin: 0 0 10px 0; font-size: 16px; color:red">í¬ì§€ì…˜</h3>
        <p id="playerInfo" style="margin: 0; font-size: 16px; color: #555;">ì„ ìˆ˜ ê¸°ë³¸ ì •ë³´ í‘œì‹œ ì˜ˆì •</p>
      </div>
    </div>

<<<<<<< HEAD
    <h2 class="mt-4">ğŸ—³ï¸ ì£¼ìš” ê¸°ë¡ ğŸ—³ï¸</h2>
    <div id="statSection"></div>
=======
    <h2 class="mt-4">ğŸ—³ï¸ì£¼ìš” ê¸°ë¡ğŸ—³ï¸</h2>

    <div id="hitterSection">
      <h3>íƒ€ì ê¸°ë¡</h3>
      <table class="record-table" id="hitterTable">
        <thead>
          <tr><th>ì—°ë„</th><th>WAR</th><th>íƒ€ìœ¨</th><th>í™ˆëŸ°</th><th>íƒ€ì </th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="catcherSection">
      <h3 style="margin-top: 40px;">í¬ìˆ˜ ê¸°ë¡</h3>
      <table class="record-table" id="catcherTable">
        <thead>
          <tr><th>ì—°ë„</th><th>WAR</th><th>íƒ€ìœ¨</th><th>ì¶œë£¨ìœ¨</th><th>ì¥íƒ€ìœ¨</th><th>OPS</th><th>ì‚¼ì§„</th><th>ë„ë£¨ì €ì§€</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="pitcherSection">
      <h3 style="margin-top: 40px;">íˆ¬ìˆ˜ ê¸°ë¡</h3>
      <table class="record-table" id="pitcherTable">
        <thead>
          <tr><th>ì—°ë„</th><th>WAR</th><th>ERA</th><th>ì‚¼ì§„</th><th>WHIP</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    
    <!-- âœ… AI ì„ ìˆ˜ í•œì¤„í‰: í•­ìƒ ë§¨ ì•„ë˜ ê³ ì • -->
    <div id="aiSummarySection" style="margin-top: 40px; background-color: #f8f9fa; padding: 20px; border-radius: 8px;">
      <h4 style="margin-bottom: 10px;">ğŸ§  AI ì„ ìˆ˜ í•œì¤„í‰</h4>
      <p id="playerSummary" style="font-size: 15px; color: #333;">ìš”ì•½ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>
>>>>>>> 0220db6f37bac6ccfe90b94976f9f674944c027c
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const pathParts = window.location.pathname.split("/");
      const pNo = pathParts[pathParts.length - 1];

      fetch(`/api/players/${pNo}?t=${Date.now()}`)
        .then(res => res.json())
        .then(player => {
          document.getElementById('playerName').textContent = player.name;
          document.getElementById('playerPosition').textContent = player.position;
          document.getElementById('viewCount').textContent = `ì¡°íšŒìˆ˜: ${player.viewCount ?? 0}`;

          const imgEl = document.getElementById('playerImage');
          if (imgEl && player.imageUrl) {
            imgEl.src = player.imageUrl;
            imgEl.onerror = () => { imgEl.src = '/images/players/default.png'; };
          }

          document.getElementById('playerInfo').innerHTML = `
            <table class="info-table">
              <tr><th>ë“±ë²ˆí˜¸</th><td>${player.backNumber ?? 'ì •ë³´ ì—†ìŒ'}</td>
              <th>ìƒë…„ì›”ì¼</th><td>${player.birthDate ?? 'ì •ë³´ ì—†ìŒ'}</td></tr>
              <tr><th>ì‹ ì¸ì§€ëª…</th><td>${player.draftInfo ?? 'ì •ë³´ ì—†ìŒ'}</td>
              <th>í™œì•½ì—°ë„</th><td>${player.activeYears ?? 'ì •ë³´ ì—†ìŒ'}</td></tr>
              <tr><th>í™œì•½íŒ€</th><td>${player.teams ?? 'ì •ë³´ ì—†ìŒ'}</td>
              <th>í•™êµ</th><td>${player.school ?? 'ì •ë³´ ì—†ìŒ'}</td></tr>
            </table>
          `;

          const statSection = document.getElementById('statSection');
          const stats = player.stats ?? [];
          if (stats.length === 0) {
            statSection.innerHTML = '<p>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
          }

          const hitterHeaders = ["Div.", "G", "PA", "AB", "H", "HR", "RBI", "AVG", "OBP", "SLG", "OPS", "WAR", "R/ePA"];
          const pitcherHeaders = ["Div.", "G", "IP", "W", "L", "ERA", "WHIP", "FIP", "SO", "WAR"];

          const statNameMapping = {
            "Div.": "êµ¬ë¶„", "G": "ê²½ê¸°ìˆ˜", "PA": "íƒ€ì„", "AB": "íƒ€ìˆ˜", "H": "ì•ˆíƒ€", "HR": "í™ˆëŸ°", "RBI": "íƒ€ì ",
            "AVG": "íƒ€ìœ¨", "OBP": "ì¶œë£¨ìœ¨", "SLG": "ì¥íƒ€ìœ¨", "OPS": "OPS", "WAR": "WAR", "R/ePA": "ë“ì  ê¸°ëŒ€ì¹˜",
            "IP": "ì´ë‹", "W": "ìŠ¹", "L": "íŒ¨", "ERA": "í‰ê· ìì±…", "WHIP": "WHIP", "FIP": "FIP", "SO": "ì‚¼ì§„"
          };

          let hitterTableCreated = false;
          let pitcherTableCreated = false;
          let hitterTable, hitterThead, hitterTbody;
          let pitcherTable, pitcherThead, pitcherTbody;

          stats.forEach(stat => {
            const map = stat.statMap || {};
            const pos = (map["Pos."] ?? '').toUpperCase();
            const isPitcher = pos === 'P';

            if (isPitcher) {
              if (!pitcherTableCreated) {
                pitcherTable = document.createElement('table');
                pitcherTable.className = 'record-table';
                pitcherThead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                pitcherHeaders.forEach(key => {
                  const th = document.createElement('th');
                  th.textContent = statNameMapping[key] ?? key;
                  headerRow.appendChild(th);
                });
                pitcherThead.appendChild(headerRow);
                pitcherTbody = document.createElement('tbody');
                pitcherTable.appendChild(pitcherThead);
                pitcherTable.appendChild(pitcherTbody);
                pitcherTableCreated = true;
              }
              const tr = document.createElement('tr');
              pitcherHeaders.forEach(key => {
                const td = document.createElement('td');
                td.textContent = map[key] ?? '-';
                tr.appendChild(td);
              });
              pitcherTbody.appendChild(tr);
            } else {
              if (!hitterTableCreated) {
                hitterTable = document.createElement('table');
                hitterTable.className = 'record-table';
                hitterThead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                hitterHeaders.forEach(key => {
                  const th = document.createElement('th');
                  th.textContent = statNameMapping[key] ?? key;
                  headerRow.appendChild(th);
                });
                hitterThead.appendChild(headerRow);
                hitterTbody = document.createElement('tbody');
                hitterTable.appendChild(hitterThead);
                hitterTable.appendChild(hitterTbody);
                hitterTableCreated = true;
              }
              const tr = document.createElement('tr');
              hitterHeaders.forEach(key => {
                const td = document.createElement('td');
                td.textContent = map[key] ?? '-';
                tr.appendChild(td);
              });
              hitterTbody.appendChild(tr);
            }
          });

<<<<<<< HEAD
          if (hitterTableCreated) statSection.appendChild(hitterTable);
          if (pitcherTableCreated) statSection.appendChild(pitcherTable);
=======
          if (!hasHitter) document.getElementById('hitterSection').style.display = 'none';
          if (!hasCatcher) document.getElementById('catcherSection').style.display = 'none';
          if (!hasPitcher) document.getElementById('pitcherSection').style.display = 'none';
          
       // âœ… AI í•œì¤„í‰ í‘œì‹œ
          document.getElementById('playerSummary').textContent = player.summary ?? 'ìš”ì•½ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤';
>>>>>>> 0220db6f37bac6ccfe90b94976f9f674944c027c

        })
        .catch(err => {
          console.error('âŒ ì„ ìˆ˜ ì •ë³´ ë¡œë”© ì‹¤íŒ¨:', err);
          document.getElementById('playerName').textContent = 'âŒ ì„ ìˆ˜ ì •ë³´ ì—†ìŒ';
        });
    });
  </script>

</th:block>
</body>
</html>
