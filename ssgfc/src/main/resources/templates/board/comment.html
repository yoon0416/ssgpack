<!-- ‚úÖ ÎåìÍ∏Ä Ï†ÑÏ≤¥ Î¶¨Ïä§Ìä∏ ÎøåÎ¶¨Í∏∞ -->
<div th:fragment="commentListFragment(comments)">
    <div class="comment-list mt-4">
        <h5>ÎåìÍ∏Ä</h5>
        <div th:each="comment : ${comments}" th:if="${comment.parent == null}">
            <div th:replace="board/comment :: commentFragment(${comment}, 0)"></div>
        </div>
    </div>
</div>

<!-- ‚úÖ ÎåìÍ∏Ä ÌïòÎÇò Ï∂úÎ†• + ÎåÄÎåìÍ∏Ä Ïû¨Í∑Ä -->
<div th:fragment="commentFragment(comment, level)">
    <div class="comment" th:style="|margin-left: ${level * 30}px;|">

        <!-- ‚úÖ ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ -->
        <div class="profile-wrapper">
            <img class="comment-profile"
                 th:src="${comment.user != null and comment.user.profile_img != null} ? 
                         @{/images/userimage/{img}(img=${comment.user.profile_img})} : 
                         '/images/userimage/default-profile.png'"
                 alt="ÌîÑÎ°úÌïÑ"
                 th:onclick="|openUserPopup(${comment.user.id})|">
        </div>

        <!-- ‚úÖ ÏûëÏÑ±Ïûê, ÏûëÏÑ±Ïùº, Ïã†Í≥† Î≤ÑÌäº Î¨∂Ïùå -->
        <div class="comment-text-wrapper">

            <div class="comment-header">
                <span class="comment-author"
                      th:if="${comment.user != null}"
                      th:text="${comment.user.nick_name}"
                      th:onclick="|openUserPopup(${comment.user.id})|"></span>
                <span class="comment-author" th:if="${comment.user == null}">ÌÉàÌá¥Ìïú ÏÇ¨Ïö©Ïûê</span>

                <span class="comment-date" th:text="${#temporals.format(comment.createDate, 'yyyy-MM-dd HH:mm')}"></span>

				<!-- ‚úÖ ÎåìÍ∏Ä Ïã†Í≥† Î≤ÑÌäº -->
				<div sec:authorize="isAuthenticated()">
				    <button type="button" class="btn btn-sm btn-outline-danger ms-2"
					        data-type="COMMENT"
					        th:data-id="${comment.id}"
					        th:data-board-id="${comment.board.id}"
					        th:data-parent-id="${comment.parent != null ? comment.parent.id : 0}"
					        onclick="handleReportButton(this)">
					    üö® Ïã†Í≥†
					</button>
				</div>
            </div>

            <!-- ‚úÖ ÎåìÍ∏Ä Î≥∏Î¨∏ (ÌôîÏÇ¥Ìëú + ÎÇ¥Ïö©) -->
            <div class="comment-body"
                 th:onclick="|toggleReplyForm(${comment.id})|"
                 style="cursor:pointer;">
                <span th:if="${level > 0}" style="color:#aaa; margin-right:5px;">‚û•</span>
                <span th:text="${comment.content}"></span>
            </div>

            <!-- ‚úÖ ÎãµÍ∏Ä ÏûÖÎ†• Ìèº -->
            <div th:id="|replyForm-${comment.id}|" class="reply-form" style="display:none;">
                <form th:action="@{'/board/' + ${comment.board.id} + '/comment/add'}" method="post" style="display:flex; align-items:center;">
                    <input type="hidden" name="parentId" th:value="${comment.id}" />
                    <textarea name="content" placeholder="ÎãµÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" rows="2"></textarea>
                    <button type="submit" class="reply-submit-btn">Îì±Î°ù</button>
                </form>
            </div>

        </div>
    </div>

    <!-- ‚úÖ ÎåÄÎåìÍ∏Ä Ïû¨Í∑Ä Ìò∏Ï∂ú -->
    <div th:each="child : ${comment.children}">
        <div th:replace="board/comment :: commentFragment(${child}, ${level + 1})"></div>
    </div>
</div>
