# ⚙️ SSGFC 프로젝트 보안 점검 정리


---

## 1. 비밀번호 재설정 기능 (보완 필요)
- **현재 상태**: 이메일만 입력해도 비밀번호가 새로 바뀜 → 이메일로 전송
- **문제점**: 본인 확인 없이 남의 비밀번호를 바꿀 수 있음 (장난 가능)
- **해결 방법**:
  - 인증번호를 이메일로 보내고, 확인한 후 변경되게 함
  - 하루에 몇 번만 가능하도록 제한
  - 누가 요청했는지 기록 남기기

---

## 2. 로그인 시도 제한 없음
- **문제점**: 아이디만 알면 비밀번호 계속 시도 가능 → 무작위 대입 위험
- **해결 방법**:
  - 비밀번호 5번 이상 틀리면 일정 시간 로그인 막기
  - 사람인지 확인하는 reCAPTCHA 도입

---

## 3. 자동 프로그램(봇) 방어 없음
- **문제점**: 자동으로 글쓰기, 회원가입, 비밀번호 재설정 시도 가능
- **해결 방법**:
  - 구글 reCAPTCHA 추가
  - 요청이 너무 많거나 비정상일 때 차단

---

## 4. XSS (스크립트 공격) 가능성
- **설명**: 게시판에 자바스크립트를 심으면 다른 사용자 브라우저에서 실행될 수 있음
- **방어 방법**:
  - 화면에 출력할 때 `th:text` 같은 자동 필터 사용
  - 위험한 경우 직접 글자 이스케이프 처리

---

## 5. SQL 인젝션
- **설명**: 입력값에 SQL 구문을 넣어서 DB를 조작하는 공격
- **현재 상태**: JPA 사용 중이라 기본적으로 안전
- **주의점**: 문자열 직접 조립하는 쿼리는 주의 필요

---

## 6. 세션 고정 위험
- **설명**: 로그인 전과 후 세션이 같으면, 다른 사람이 세션을 탈취할 수 있음
- **해결 방법**:
  - 로그인 성공 시 기존 세션 초기화

---

## 7. 탈퇴 후 세션 유지
- **설명**: 탈퇴해도 로그인 상태가 유지되면 위험함
- **해결 방법**:
  - 탈퇴 시 세션 완전 종료

---

## 8. 관리자 주소 예측 쉬움
- **설명**: `/admin/**` 형태는 너무 예측 가능
- **해결 방법**:
  - 관리자 페이지 접근을 IP나 추가 인증으로 제한
  - 관리자 행위도 로그 남기기

---

## 9. CSRF 보호 미확인
- **설명**: 사용자의 의도 없이 악성 요청이 전송될 수 있음
- **해결 방법**:
  - POST 요청에 CSRF 토큰을 포함

---

## 10. 권한 확인 누락 가능
- **설명**: 특정 주소에 role 체크가 빠졌을 수 있음
- **해결 방법**:
  - 전체 URL별로 접근 권한 재점검

---

## 11. 인증 안 된 유저는 기능 제한
- **현재 상태**: 이메일/전화/소셜 인증 안 하면 글쓰기, 댓글, 투표 불가
- **추가 내용**: 마이페이지에서 인증 유도 문구 출력

---

## 12. 로그 시스템 구성
- **경로**: logs/user/ / logs/admin/
- **기록 내용**:
  - 로그인, 회원가입, 탈퇴 등 모든 주요 기능 기록
  - 관리자 로그 따로 분리
  - 마스터 관리자 로그는 비공개 별도 저장
  - 로그가 변경되면 바로 이메일 전송

---

## 13. 유저 탈퇴 및 강제 삭제 정책
- **현재 상태**: 탈퇴/벤 시 DB에서 완전 삭제
- **개선 예정**:
  - 30일 동안은 탈퇴 상태로 보관
  - 게시판에는 “탈퇴한 회원”처럼 표시
  - 30일 후 진짜 삭제

---

## 14. 탈퇴 유저 로그인 차단 미흡
- **현재 상태**: 탈퇴 후에도 이메일/비밀번호가 맞으면 로그인 가능
- **문제점**: 탈퇴 후 재접속해 테러 가능성
- **해결 방법**:
  - 로그인 시 `user.isDeleted()` 조건 추가
  - 로그 기록에 `LOGIN_FAIL : 탈퇴유저 시도` 항목 남기기

---

---

## 15. SSGFC 실제 적용 가능 보안 위협 분석

현재 프로젝트 코드 기준으로 실제로 발생 가능성이 있는 공격 기법들

| 공격기법 | 현재 가능성 | 설명 |
|----------|--------------|------|
| 탈퇴 유저 로그인 허용 | 높음 | 로그인 시 `user.isDeleted()` 확인 로직 없음. 탈퇴 유저가 다시 로그인 가능 |
| 비밀번호 재발급 인증 없음 | 높음 | 이메일만 입력해도 비밀번호 변경됨. 인증번호 확인 없음 |
| 로그인 시도 제한 없음 (Brute-force) | 높음 | 비밀번호 5회 실패 제한 없음. 자동화 공격에 취약 |
| 세션 고정 (Session Fixation) | 중간~높음 | 수동 인증 구조이므로 로그인 후 기존 세션 유지 가능성 있음 |
| IDOR (직접 객체 참조) | 중간 | 마이페이지, 회원정보 수정 등에서 ID 검증이 없으면 타인 정보 접근 가능 |
| 파일 업로드 제한 없음 | 중간 | 프로필 이미지 업로드 시 확장자 및 MIME 타입 제한 확인 필요 |
| 로그 인젝션 (Log Injection) | 낮음~중간 | 이메일 등 사용자 입력값을 로그에 직접 기록. 줄바꿈 문자 등으로 조작 가능 |
| 오픈 리디렉션 (Open Redirect) | 낮음 | 현재는 리디렉트 파라미터 직접 처리 없음. 향후 도입 시 주의 필요 |

---

---

## 16. 운영 환경 및 네트워크 기반 보안 항목 (추가 고려 사항)

| 항목 | 설명 | 현재 상태 | 보완 방향 |
|------|------|------------|------------|
| 해외 IP 차단 (관리자 페이지) | 관리자 경로는 국내 IP로만 제한 | 미구현 | 관리자 접근 시 IP 필터링 적용 (서버 또는 필터단) |
| 해외 IP 선택적 차단 (유저) | 유저는 설정에 따라 해외 로그인 제한 가능 | 미구현 | "해외 로그인 차단" 선택 기능 제공 |
| 관리자 추가 인증 | 아이디/비번 외에 2차 인증 없음 | 미구현 | 관리자 로그인 시 이메일/전화 코드 인증 추가 |
| 관리자 접근 감시 | 관리자 이상행동 (심야 접속 등) 탐지 없음 | 미구현 | 이상 로그인 시간대 로그 기록 및 알림 |
| 관리자 로그 강화 | 관리자 행동은 일반 로그와 분리 기록 | 적용 중 | Slack/메일 등 실시간 알림 도입 가능 |
| 관리자 URL 난독화 | `/admin/**` 구조는 예측 쉬움 | 단순함 | 관리자 접근 URL을 난독화하거나 보안 토큰 적용 |
| 파일 업로드 스토리지 격리 | 업로드 이미지가 static 폴더에 있음 | 확인 필요 | `/images/userimage`가 웹 루트 하위면 위험. S3 또는 별도 경로 추천 |
| 비정상 요청 차단 (Rate Limiting) | 반복 요청 탐지 불가 | 미구현 | IP 단위 요청 수 제한 적용 (Spring Filter, nginx 등) |
| API 인증 및 토큰 유효기간 | REST API 사용 시 토큰 만료 처리 없음 | 해당 없음 | 추후 API 도입 시 JWT 만료 + 재발급 고려 |
| DB 백업 접근 제한 | DB 백업 파일 외부 노출 위험 | 확인 필요 | `db_backup.sql`, `*.bak` 등 웹 루트 경로에서 제거 |

---

## 17. 요청 제한 미적용 (Rate Limiting 없음)
- **설명**: 로그인, 인증번호 요청, 댓글 작성 등에 요청 횟수 제한이 없음
- **문제점**:
  - 공격자가 인증번호 요청을 수십 번 시도 가능
  - 로그인 시도, 게시판 댓글 도배 등 무한 반복 가능
- **해결 방법**:
  - IP별 요청 수 제한 (예: 5초에 1회)
  - Spring 인터셉터, 필터 또는 nginx 설정으로 구현 가능

---

## 18. 로그 민감 정보 노출
- **설명**: 로그에 이메일, 닉네임, 로그인 실패 사유 등 사용자 정보가 평문으로 남아있음
- **문제점**:
  - 로그 파일 유출 시 사용자 개인정보 유출 위험
  - 탈퇴 유저, 실패 비밀번호 등의 상황이 그대로 기록됨
- **해결 방법**:
  - 이메일 중간 마스킹 (예: yo***@gmail.com)
  - 로그에 비밀번호 등 민감 데이터 절대 기록 금지
  - JSON 로그 저장 시 민감 필드 제외

---

## 19. 인증번호 요청 도배 가능성 (Rate Limiting 없음)
- **설명**: 이메일 또는 전화번호 인증 시 인증번호를 계속 요청할 수 있음
- **문제점**:
  - 인증요청 버튼을 반복 클릭해 사용자에게 도배 메일/문자 전송 가능
  - 인증 API가 무제한 호출되면 서버에도 부하 발생
- **해결 방법**:
  - 인증 요청에 시간 제한 (예: 1분 내 재요청 불가)
  - 동일 IP 또는 계정에 대한 요청 횟수 제한
  - session 또는 Redis에 요청 시각 기록해 제어

---

## 20. 인증 링크 재사용 공격
- **설명**: 이메일 인증 URL을 저장해두면, 언제든지 접속해서 인증이 완료됨
- **문제점**:
  - 다른 사람이 인증 URL을 복사해서 나중에 인증할 수도 있음
  - 공격자가 인증 메일을 탈취했다면 인증 우회 가능
- **해결 방법**:
  - 인증코드에 유효시간(예: 10분) 설정
  - 인증 성공 시 해당 인증코드는 즉시 폐기 처리
  - 사용된 인증 URL은 더 이상 작동하지 않게 설정

---
### 보완이 잘 된 항목 (현재 구조 기준 안전)

| 항목 | 설명 |
|------|------|
| XSS 대응 | Thymeleaf `th:text` 사용으로 자동 이스케이프 처리 |
| SQL Injection | JPA 사용으로 기본적으로 안전한 PreparedStatement 구조 |
| HTTP Verb Tampering | RESTful 구조 아님. 대부분 POST/GET 방식만 사용 |
| Header Injection | 응답 헤더 조작하는 사용자 입력 없음. 위험 낮음 |

---

## 21. 보안 헤더 미설정 (기본 브라우저 보안 기능 부재)

**보안 헤더(Security Headers)**는 브라우저에게 "이 사이트는 보안적으로 이렇게 동작할 거야"라고 알려주는 설정
Spring Boot 프로젝트에서 기본값이 적용되지 않는 경우가 많기 때문에, 명시적으로 설정해줘야 함

---

### 1. `X-Frame-Options: DENY`

- **설명**: 다른 사이트에서 `<iframe>`으로 내 사이트를 삽입하는 것을 차단
- **공격 시나리오**: 공격자가 너의 페이지를 iframe에 삽입하고, 위에 투명한 버튼을 덧씌워 클릭 유도 → 관리자 행동 유출
- **설정 방법**:
  ```java
  http.headers().frameOptions().deny();
  ```

---

### 2. `X-Content-Type-Options: nosniff`

- **설명**: 브라우저가 파일의 MIME 타입을 추측하지 못하게 함
- **공격 시나리오**: jpg 확장자를 가진 악성 js 파일을 업로드한 후, 브라우저가 JS로 인식하여 실행할 수 있음
- **설정 방법**:
  ```java
  http.headers().contentTypeOptions();
  ```

---

### 3. `X-XSS-Protection: 1; mode=block`

- **설명**: 브라우저의 XSS 필터 기능을 활성화
- **공격 시나리오**: 공격자가 `<script>alert(1)</script>` 등을 입력했을 때, 브라우저에서 자동으로 차단함
- **설정 방법**:
  ```java
  http.headers().xssProtection().block(true);
  ```

---

### 전체 설정 예시 (`SecurityConfig.java` 내부)

```java
http
    .headers()
        .xssProtection().block(true)
    .and()
        .frameOptions().deny()
    .and()
        .contentTypeOptions();
```

---

## 22. 사용자 활동 로그 미구현

- **설명**: 로그인, 글쓰기, 댓글, 마이페이지 변경 등 사용자 행동에 대한 로그 기록이 없음
- **위험성**:
  - 이상 접속(심야시간), 갑작스런 활동 급증 등을 파악하기 어려움
- **해결 방법**:
  - 로그에 사용자 IP, 접속 시간, 브라우저 정보 등 포함
  - 사용자별 활동 히스토리를 기록하여 추후 이상행동 분석 가능

---

## 23. 관리자 이상행동 실시간 알림 미구현

- **설명**: 관리자 계정으로 새벽에 접속하거나, 특정 기능을 반복적으로 사용할 경우 알림이 없음
- **위험성**:
  - 공격자가 관리자 계정을 탈취한 경우 탐지 지연
- **해결 방법**:
  - 이상 접속/행동 탐지 시 이메일 또는 Slack 등으로 알림 전송
  - 예: 새벽 2~5시 사이 관리자 로그인 발생 시 경고 알림

---

## 24. 보안 테스트 도구 미사용

- **설명**: OWASP Top 10 기반의 취약점 테스트를 아직 진행하지 않음
- **보완 필요성**:
  - 수동 점검 외에도 도구 기반 자동 테스트가 중요
- **해결 방법**:
  - 다음과 같은 도구로 테스트 진행:
    - **OWASP ZAP**: 웹 취약점 자동 분석 도구
    - **BurpSuite**: 로그인, 세션, 인증 등 상세 분석
    - **Spring Security Test**: API 보안 테스트 유닛 구성 가능

---

---

## 사용한 보안 기술 요약

| 항목 | 내용 |
|------|------|
| 로그인 처리 | Spring Security + 커스텀 로그인 |
| 권한 설정 | Role(숫자 등급)으로 구분 |
| 비밀번호 | BCrypt로 암호화 저장 |
| 인증 방식 | 이메일, 전화번호, 카카오/구글/네이버 |
| 로그 기록 | 기능별 로그 파일 저장 + 관리자 별도 처리 |
| 보호 기능 | CSRF, XSS 대응, 세션 보호 등 |

---

## 앞으로 추가하면 좋은 보안 기능

- 관리자 이상행동 감지 (새벽 접속, 반복 탈퇴 등)
- 탈퇴 계정 30일 보관
- 파일 업로드 제한 (jpg, png 등만 허용)
- 비밀번호 재사용 방지
- Slack/이메일로 관리자 실시간 알림
- 유저의 민감정보(주소, 전번) 암호화 저장
